# تشغيل البوت 24/7

هذا الدليل يشرح كيفية تشغيل البوت بشكل مستمر 24/7 على Windows.

## الطرق المتاحة

### الطريقة 1: استخدام `run_bot_service.py` (مُوصى بها)

هذه الطريقة تستخدم Python script مع إعادة التشغيل التلقائي:

#### خطوات التشغيل:

1. **فتح Terminal (PowerShell أو CMD)**
   ```bash
   cd "D:\Reminder bot"
   ```

2. **تفعيل Virtual Environment (إن وجد)**
   ```bash
   venv\Scripts\activate
   ```

3. **تشغيل البوت**
   ```bash
   python run_bot_service.py
   ```

#### الميزات:
- ✅ إعادة التشغيل التلقائي في حالة الفشل
- ✅ تسجيل جميع الأخطاء في `bot_service.log`
- ✅ حد أقصى لمحاولات إعادة التشغيل (10 محاولات)
- ✅ انتظار قبل إعادة التشغيل (5 ثواني)

---

### الطريقة 2: استخدام `start_bot.bat`

هذه الطريقة تستخدم ملف batch لتشغيل البوت:

#### خطوات التشغيل:

1. **النقر المزدوج على `start_bot.bat`**
   - أو فتح Terminal وتشغيل:
   ```bash
   start_bot.bat
   ```

#### الميزات:
- ✅ سهل الاستخدام
- ✅ تفعيل تلقائي لـ virtual environment
- ✅ التحقق من وجود الملفات المطلوبة

---

### الطريقة 3: استخدام `start_bot_forever.bat`

هذه الطريقة تشغّل البوت في نافذة منفصلة في الخلفية:

#### خطوات التشغيل:

1. **النقر المزدوج على `start_bot_forever.bat`**
   - أو فتح Terminal وتشغيل:
   ```bash
   start_bot_forever.bat
   ```

#### الميزات:
- ✅ تشغيل في الخلفية (نافذة منفصلة)
- ✅ يمكن إغلاق النافذة الرئيسية
- ✅ إعادة التشغيل التلقائي

---

### الطريقة 4: استخدام PowerShell Script

هذه الطريقة تستخدم PowerShell script:

#### خطوات التشغيل:

1. **فتح PowerShell كمسؤول (Run as Administrator)**
   ```powershell
   cd "D:\Reminder bot"
   ```

2. **تشغيل Script**
   ```powershell
   .\start_bot_service.ps1
   ```

#### الميزات:
- ✅ واجهة ملونة
- ✅ رسائل واضحة
- ✅ معالجة أخطاء محسّنة

---

## إعدادات إعادة التشغيل

يمكن تعديل إعدادات إعادة التشغيل في `run_bot_service.py`:

```python
MAX_RESTART_ATTEMPTS = 10  # عدد محاولات إعادة التشغيل قبل التوقف
RESTART_DELAY = 5  # وقت الانتظار قبل إعادة التشغيل (بالثواني)
MIN_UPTIME = 60  # الحد الأدنى لوقت التشغيل قبل اعتبارها إعادة تشغيل ناجحة (بالثواني)
```

---

## تشغيل البوت كخدمة Windows (متقدم)

لتشغيل البوت كخدمة Windows حقيقية، يمكن استخدام **NSSM (Non-Sucking Service Manager)**:

### خطوات التثبيت:

1. **تحميل NSSM**
   - من الموقع الرسمي: https://nssm.cc/download
   - أو استخدام Chocolatey: `choco install nssm`

2. **تثبيت البوت كخدمة**
   ```bash
   nssm install TelegramBotService "D:\Reminder bot\venv\Scripts\python.exe" "D:\Reminder bot\run_bot_service.py"
   ```

3. **تعيين دليل العمل**
   ```bash
   nssm set TelegramBotService AppDirectory "D:\Reminder bot"
   ```

4. **بدء الخدمة**
   ```bash
   nssm start TelegramBotService
   ```

5. **إيقاف الخدمة**
   ```bash
   nssm stop TelegramBotService
   ```

6. **حذف الخدمة**
   ```bash
   nssm remove TelegramBotService
   ```

---

## مراقبة البوت

### 1. مراجعة اللوغات

- **bot.log** - لوغات البوت الرئيسية
- **bot_service.log** - لوغات خدمة التشغيل (إعادة التشغيل، الأخطاء، إلخ)

### 2. فحص حالة البوت

يمكنك إرسال رسالة للبوت للتحقق من أنه يعمل:
- `/start` - يجب أن يرد البوت برسالة ترحيب

### 3. مراقبة استخدام الموارد

استخدم **Task Manager** لمراقبة:
- استخدام الذاكرة (Memory)
- استخدام المعالج (CPU)
- حالة العملية (Process Status)

---

## استكشاف الأخطاء

### المشكلة: البوت يتوقف فجأة

**الحل:**
1. تحقق من `bot_service.log` للأخطاء
2. تحقق من `bot.log` للأخطاء في البوت
3. تأكد من وجود `BOT_TOKEN` في ملف `.env`
4. تأكد من اتصال الإنترنت

### المشكلة: البوت يعيد التشغيل باستمرار

**الحل:**
1. تحقق من الأخطاء في `bot_service.log`
2. تحقق من إعدادات قاعدة البيانات
3. تحقق من وجود ملفات مطلوبة (handlers.py, db.py, إلخ)
4. حاول تشغيل البوت مباشرة (`python bot.py`) لرؤية الخطأ

### المشكلة: البوت لا يستجيب

**الحل:**
1. تحقق من اتصال الإنترنت
2. تحقق من صحة `BOT_TOKEN`
3. أعد تشغيل البوت
4. تحقق من لوغات البوت

---

## نصائح للتشغيل 24/7

1. **استخدم Virtual Environment**
   - يحافظ على بيئة نظيفة ومنعزلة

2. **راقب اللوغات بانتظام**
   - تحقق من `bot.log` و `bot_service.log` يومياً

3. **قم بنسخ احتياطي للقاعدة البيانات**
   - البوت يقوم بنسخ احتياطي تلقائي، لكن يمكنك عمل نسخة يدوية

4. **استخدم Task Scheduler (Windows)**
   - يمكن جدولة إعادة تشغيل البوت يومياً في وقت معين

5. **راقب استخدام الموارد**
   - تأكد من أن البوت لا يستخدم موارد كثيرة

---

## أوامر مفيدة

### إيقاف البوت
- اضغط `Ctrl+C` في Terminal
- أو أغلق النافذة
- أو استخدم Task Manager لإنهاء العملية

### إعادة تشغيل البوت
- أوقف البوت (Ctrl+C)
- شغّل البوت مرة أخرى (`python run_bot_service.py`)

### فحص حالة البوت
```bash
# فحص اللوغات
tail -f bot.log
tail -f bot_service.log

# فحص العمليات الجارية
tasklist | findstr python
```

---

## ملاحظات مهمة

1. **يجب أن يكون الكمبيوتر يعمل 24/7**
   - إذا أُغلق الكمبيوتر، سيُوقف البوت

2. **يجب أن يكون هناك اتصال بالإنترنت**
   - بدون اتصال، لن يعمل البوت

3. **يجب أن يكون Python مثبتاً**
   - تأكد من تثبيت Python 3.8 أو أحدث

4. **يجب أن تكون جميع المكتبات مثبتة**
   - شغّل `pip install -r requirements.txt`

---

## الخلاصة

أسهل طريقة لتشغيل البوت 24/7:
1. استخدم `run_bot_service.py` للتشغيل مع إعادة التشغيل التلقائي
2. شغّله في Terminal أو نافذة منفصلة
3. راقب اللوغات بانتظام
4. تأكد من أن الكمبيوتر متصل بالإنترنت ويعمل 24/7

---

## للمساعدة

إذا واجهت مشاكل:
1. تحقق من اللوغات (`bot.log`, `bot_service.log`)
2. تحقق من ملف `.env` (BOT_TOKEN, ADMIN_IDS)
3. تحقق من اتصال الإنترنت
4. تأكد من تثبيت جميع المكتبات المطلوبة

